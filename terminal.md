# Linux-terminal相关知识以及如何实现su 
        
### 越狱概论
首先，想要获取root，在正常的pc电脑上一般都是存在的，但是在移动终端设备上(android/ios),发行版是不给用户提供root接口的，但是我们想要root权限，这叫越狱。

+ 越狱主要分为两类：
    + 有根root：就是在使用越狱之后，root权限一直存在，随用随取，重启不消失
    + 无根root：使用了越狱之后，获取了root权限，但是重启后会消失，重启后想要再使用root权限，需要再次使用越狱工具获取权限


+ 越狱方式：
    + 漏洞提权

        这一种在比较普遍和通用，不仅仅是移动设备，pc设备也通用。能够提权的漏洞一般都是比较严重的漏洞，一年也没几个，但是基本每个版本都会有，比如ios，可以说，从开始到现在，一直有漏洞，虽然最新版本的漏洞还没有更新出来，但是迟早会有，andriod也是一样。漏洞可能还分为硬件和软件漏洞，这种就不细说了，主要还是看严重程度。大部分漏洞提权，都只能获得无根root,ios听说以前有一些有根的root,这种很少。

    + 通过修改固件提权

        这种在理论上来说，是百分之百可能，android 由于是开源的，可以直接编译一个新的有root权限的固件刷进去，或者直接通过magisk，修改现有固件，然后刷进行，ios,目前研究不多，后续有时间了，这部分会补上。

        但是这种通过固件提权的方式，有个问题，就是有可能会被反击，也就是厂家内置了一些固件验证，必须要过了这些验证，才能正常启动，否则是不允许启动的。

+ 安全性：

    越狱的人，基本已经很少考虑这个问题。

    目前我用的ios越狱，就是无根越狱，而android用的是magisk，就是修改固件越狱。就安全性而言，固件越狱是比漏洞越狱更加安全。
    
    漏洞越狱，预示这你的手机存在root提权漏洞，不仅你可以提权，任何一个第三方app,都有和你一样的提权机会，从而获取root权限。
    
    而固件提权，只要管控好root权限的管理程序，除了你自己，没有人可以进行固件提权(不要抬你手机有漏洞的杠)。

    所以ios越狱手机还是少用为好，尽早更新到新版本。magisk的android 还是可以用一用的


## ios越狱 (研究中，后续会补上)

## android越狱
    上面聊过了越狱的方式所以，防御的方式也有两个，固件防御和漏洞提权防御

### 固件防御

+ 1、固件根文件系统变成rom

    早期固件估计没有任何防御，直接找个漏洞提权，获取root,然后改写文件系统，设置自启，估计就行当时root的app满大街都是，这个不行换一个，总有一个可以。跟一些普通的班子差不多。虽然不是通过固件提权，但是固件的设计问题，导致了永久root。

    为了防止固件被漏洞永久提权、将文件系统变成只读的，这样即使漏洞提权了，重启后，文件系统不会被改写，无法内置root。

+ 2、开启固件验证AVB、回滚保护

    android 有个recovery分区应该都知道，然后配合当年很火的supersu，直接能刷进去一个su,然后就能获取root权限，这种方式就是直接改的根文件系统，虽然根文件系统是rom，但是直接改磁盘文件，把boot.img里面的根文件系统添加文件进去，或者改system.img，因为system.img挂载到/system目录下，/system/bin 也是可执行路径。xposed，刷的就是system.img 。

    到了android 8,已经是xposed最后的荣光了，在这一版本，已经可以启用了AVB验证

    + Android Verified Boot(这个没仔细查，研究的时候已经是2.0了)

        多了一个vbmeta.img分区，用于校验 boot.img system.img vendor.img 这些分区，确保不被不被篡改(解锁，关闭)
        回滚保护，直接修改system.img镜像，无效，数据在启动的时候如果有vbmeta验证，会将数据修正。

+ 3、selinux

    selinux这个个人觉得即使固件防御，也是漏洞防御。

### 固件攻击-magisk

聊android越狱，不可能不谈magisk。




### 漏洞防御
android 4.4 好像就有了，5.0强制开了，seandroid 就是那个动态权限申请，都是基于selinux策略。


+ 1、漏洞提权
    + 拥有root权限的应用

        adbd服务，是android对外的命令行接口，最初是有root权限的，用户调用shell接口的时候，会权限降级，返回一个shell用户，然后有人就分析adbd的代码，挖掘adbd的漏洞，或者说挖掘拥有root权限的应用的漏洞，来获取root权限。

    + 内核漏洞提权

        这个不用解释了把
    
+ 2、selinux

    linux下有两种权限管控，传统的DAC（直接访问控制)，和MAC（强制访问控制）安全机制(selinx)。
    关于selinux,我看了很多资料，很长时间没弄明白，所以在这里就我自己的理解详细写一下。

    + MAC和DAC

        + DAC

            是以用户为主体，比如，就像现实世界中的人，你运动，你学习，你考大学，你装修，把自己的房子烧了，没人管你的，你的这些行为，就是进程，而你烧房子，花钱，等等，就是操作文件，房子就是文件，钱，就是文件，你怎么操作，没人管你，因为他们是属于你的，你是主体。

        + MAC 

            mac以进程为主体，文件，属性为客体，就像现实世界中，以事件为主体，物质为客体，这种情况下，假如你要烧你的房子，假如假如你要花你的钱，在DAC中是允许的，但是在mac中，会首先判断你的行为事件，比如你的行为事件是装修，是需要对房子进行操作的，但是你的操作确是烧房子，拆房子，就会被禁止，比如你要吃饭，是要花钱的，但是你的操作是花钱买法拉利了，这也是没有权限的。粒度为进程(有安全上下文标签)，，管控行为，为读写，执行，等等，被执行者(文件)贴上标签，进程操作被文件的时候，通过进程和文件的标签判断，是否可以操作。

    selinux,是在mac基础上进行的加强和扩展

    + selinux 工作原理

        + 在编译的时候，确定了大致的安全策略，尤其一些比较重要，权限高的文件。这些安全策略会将这些文件管理的死死的，不会给予他们任何多余的权限

        + 全文件加标签，会将每一个文件都加上安全上下文的标签，彻彻底底的管控

        + 主要工作点是内核模块，在内核各个操作点，添加钩子，当操作发生的时候，会首先通过安全策略进行判断。(只要钩子写的全，就不可能绕过去)


    + selinux 对于漏洞的防御

        selinux能防御应用层的root权限漏洞，对于内核层的root权限漏洞，存在直接从内核关闭selinux的可能

        对于selinux 而言，是不是root，没有任何区别，root这个概念是DAC所提供的的用户概念，而selinux是策略控制的，不会因为，你是root用户，就不对你进行策略管控

        root用户在DAC权限来说是有关闭selinux的权限的(android上，别的linux没搞过，不清楚)，但是如果selinux如果打开了，你就要拥有关闭selinux权限的MAC策略权限。

        内核漏洞如果无法直接从内核层面关闭selinux，那么即使获取了root，也是无法绕过selinux策略的，跟用户层的root提权漏洞会面临一样的结果。



#### 安装教程

1.  xxxx
2.  xxxx
3.  xxxx

#### 使用说明

1.  xxxx
2.  xxxx
3.  xxxx

#### 参与贡献

1.  Fork 本仓库
2.  新建 Feat_xxx 分支
3.  提交代码
4.  新建 Pull Request


#### 特技

1.  使用 Readme\_XXX.md 来支持不同的语言，例如 Readme\_en.md, Readme\_zh.md
2.  Gitee 官方博客 [blog.gitee.com](https://blog.gitee.com)
3.  你可以 [https://gitee.com/explore](https://gitee.com/explore) 这个地址来了解 Gitee 上的优秀开源项目
4.  [GVP](https://gitee.com/gvp) 全称是 Gitee 最有价值开源项目，是综合评定出的优秀开源项目
5.  Gitee 官方提供的使用手册 [https://gitee.com/help](https://gitee.com/help)
6.  Gitee 封面人物是一档用来展示 Gitee 会员风采的栏目 [https://gitee.com/gitee-stars/](https://gitee.com/gitee-stars/)
